<!doctype html>
<html>
    <head>
        <link rel="icon" type="image/x-icon" href="../favicon.ico" />
        <title>Confab</title>
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content"
        />
        <link rel="stylesheet" href="../loader.css" />
        <script src="../loader.js" defer></script>

        <link rel="stylesheet" href="../base.css" />
        <link rel="stylesheet" href="chat.css" />
        <link
            href="https://fonts.googleapis.com/icon?family=Material+Icons"
            rel="stylesheet"
        />
        <script src="state.js" defer></script>
        <script src="../crypto.js" defer></script>
        <script src="../utils.js" defer></script>
        <script src="../auth/auth.js" defer></script>
        <script src="storage.js" defer></script>
        <script src="ui.js" defer></script>
        <script src="api.js" defer></script>
        <script src="websocket.js" defer></script>
        <script src="events.js" defer></script>
        <script src="main.js" defer></script>
        <script src="https://unpkg.com/wavesurfer.js@7"></script>
        <script src="https://unpkg.com/wavesurfer.js@7/dist/plugins/regions.min.js"></script>
        <script
            type="module"
            src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"
        ></script>
    </head>
    <body class="chat-page">
        <div class="status-bar">
            <div class="status-bar-left">
                <button
                    id="status-bar-back-btn"
                    class="status-bar-back-btn"
                    style="display: none"
                >
                    <span class="material-icons">keyboard_backspace</span>
                </button>
                <div class="connection-status" id="connection-status">
                    <span class="status-text"></span>
                    <span class="material-icons status-icon"></span>
                </div>
            </div>
            <label class="theme-toggle-switch">
                <input
                    type="checkbox"
                    id="theme-toggle-checkbox"
                    onchange="toggleTheme()"
                />
                <span class="slider"></span>
            </label>
        </div>

        <div class="page-wrapper">
            <div id="loading-overlay" class="loading-overlay hidden">
                <div class="loading-container"></div>
            </div>
            <div id="chat-app">
                <!-- Sidebar: Chat List -->
                <aside id="chat-list">
                    <div class="chat-header">
                        <h2>Chats</h2>
                        <div class="chat-header-actions">
                            <button
                                id="profile-btn"
                                class="material-icons md-40"
                                onclick="app.ui.goToProfile()"
                                title="Profile"
                            >
                                account_circle
                            </button>
                        </div>
                    </div>
                    <div id="user-list">
                        <!-- Contacts will be injected here by chat.js -->
                    </div>
                    <button
                        id="add-contact-btn"
                        class="add-contact-float material-icons md-40"
                        title="Add Contact"
                    >
                        person_search
                    </button>
                </aside>

                <!-- Chat Window -->
                <main id="chat-view">
                    <div id="chat-view-cover">
                        <h2>Welcome to Confab</h2>
                        <p>
                            Select a conversation from the list on the left,<br />or
                            find someone new to talk to.
                        </p>
                    </div>
                    <header id="chat-view-header" class="chat-view-header">
                        <div
                            id="chat-view-avatar"
                            class="chat-view-avatar hideavatar"
                        ></div>
                        <div class="chat-view-titlebar">
                            <h3 id="chat-title">Select a chat</h3>
                            <p id="chat-subtitle">
                                or add a new contact to start messaging!
                            </p>
                        </div>
                    </header>
                    <div id="messages">
                        <!-- Messages will be injected here by chat.js -->
                    </div>
                    <div
                        id="message-actions-popup"
                        class="message-actions-popup hidden"
                    >
                        <button id="copy-message-btn">
                            <span class="material-icons">content_copy</span>Copy
                        </button>
                        <button id="forward-message-btn">
                            <span class="material-icons">forward</span>Forward
                        </button>
                        <button id="delete-message-btn">
                            <span class="material-icons">delete</span>Delete
                        </button>
                        <button id="edit-message-btn">
                            <span class="material-icons">edit</span>Edit
                        </button>
                    </div>
                    <div
                        id="message-actions-overlay"
                        class="modal-overlay hidden"
                    ></div>
                    <div id="emoji-picker-container" class="hidden">
                        <emoji-picker></emoji-picker>
                    </div>
                    <form
                        id="message-form"
                        onsubmit="event.preventDefault(); sendMessage(currentChatUser);"
                    >
                        <button
                            type="button"
                            id="emoji-button"
                            class="material-icons"
                        >
                            mood
                        </button>
                        <textarea
                            id="message-input"
                            placeholder="Type a message..."
                        ></textarea>
                        <div id="voice-ui-wrapper" class="hidden">
                            <div id="audio-filters-container">
                                <button class="filter-btn" data-filter="none">
                                    None
                                </button>
                                <button
                                    class="filter-btn"
                                    data-filter="lowpass"
                                >
                                    Low-Pass
                                </button>
                                <button
                                    class="filter-btn"
                                    data-filter="highpass"
                                >
                                    High-Pass
                                </button>
                                <button
                                    class="filter-btn"
                                    data-filter="talkingtom"
                                >
                                    Talking Tom
                                </button>
                            </div>
                            <div id="waveform-container"></div>
                            <div id="voice-message-container">
                                <!-- Recording State -->
                                <div id="voice-recording-state" class="hidden">
                                    <div class="recording-info">
                                        <div class="visualizer"></div>
                                        <span id="recording-timer">0:00</span>
                                    </div>
                                    <div class="recording-actions">
                                        <button
                                            type="button"
                                            id="pause-resume-recording-btn"
                                            class="material-icons"
                                        >
                                            pause
                                        </button>
                                        <button
                                            type="button"
                                            id="stop-recording-btn"
                                            class="material-icons"
                                        >
                                            stop
                                        </button>
                                        <button
                                            type="button"
                                            id="cancel-recording-btn"
                                            class="material-icons"
                                        >
                                            delete
                                        </button>
                                    </div>
                                </div>

                                <!-- Playback State -->
                                <div id="voice-playback-state" class="hidden">
                                    <button
                                        type="button"
                                        id="play-pause-btn"
                                        class="material-icons"
                                    >
                                        play_arrow
                                    </button>
                                    <span id="playback-timer">0:00 / 0:00</span>
                                    <div class="spacer"></div>
                                    <button
                                        type="button"
                                        id="delete-recording-btn"
                                        class="material-icons"
                                    >
                                        delete
                                    </button>
                                    <button
                                        type="button"
                                        id="send-voice-message-btn"
                                        class="material-icons"
                                    >
                                        send
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button
                            type="button"
                            id="record-button"
                            class="material-icons"
                        >
                            mic
                        </button>
                        <button type="submit" id="send-button">➤</button>
                    </form>
                </main>
            </div>

            <!-- Modal Overlay -->

            <!-- Main Modal Overlay -->
            <div id="modal-overlay" class="modal-overlay hidden"></div>

            <!-- Add Contact Modal -->
            <div id="add-contact-modal" class="modal hidden">
                <div class="modal-header">
                    <h2>Find People</h2>
                    <button id="close-add-contact-modal" class="close-button">
                        &times;
                    </button>
                </div>
                <input
                    type="search"
                    id="user-search-input"
                    placeholder="Search by name or username..."
                    class="search-input"
                />
                <div
                    id="search-results"
                    class="search-results custom-scrollbar"
                >
                    <p class="search-results-placeholder">
                        Start typing to find users.
                    </p>
                </div>
            </div>

            <!-- Profile View Modal -->
            <div id="profile-view-modal" class="modal profile-modal hidden">
                <div class="modal-header">
                    <h2>Profile</h2>
                    <button id="close-profile-modal" class="close-button">
                        &times;
                    </button>
                </div>
                <div id="profile-content" class="profile-content">
                    <!-- Profile details will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </body>
</html>
